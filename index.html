<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tik Market</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --main: #ff2d75; --bg: #000000; --card: #1a1a1a; }
        html, body { margin:0; padding:0; background:var(--bg); color:white; font-family:sans-serif; overflow-x:hidden; -webkit-text-size-adjust:100%; }
        .header { padding:20px; text-align:center; border-bottom:2px solid var(--main); }
        .container { padding:20px; padding-bottom:100px; }
        .tab { display:none; } .active { display:block; }
        .card { background:var(--card); padding:15px; border-radius:12px; border:1px solid var(--main); margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; }
        .btn { background:var(--main); color:white; border:none; padding:12px; border-radius:10px; width:100%; font-weight:bold; cursor:pointer; }
        textarea, input { width:100%; padding:15px; margin:10px 0; border-radius:10px; border:1px solid #444; background:#222; color:white; font-size:16px !important; box-sizing:border-box; }
        .navbar { position:fixed; bottom:0; width:100%; background:#111; display:flex; justify-content:space-around; padding:15px 0; border-top:2px solid var(--main); }
        .nav-item { color:#888; cursor:pointer; font-weight:bold; }
        .nav-item.active-nav { color:var(--main); }
    </style>
</head>
<body>

<div class="header"><h2>TIK MARKET</h2></div>

<div class="container">
    <div id="store-tab" class="tab active">
        <div id="cats">
            <button class="btn" style="margin-bottom:10px" onclick="filter('3C/L')">3C/L</button>
            <button class="btn" style="margin-bottom:10px" onclick="filter('4CC/LL')">4CC/LL</button>
            <button class="btn" style="margin-bottom:10px" onclick="filter('4C/L')">4C/L</button>
            <button class="btn" style="margin-bottom:10px" onclick="filter('Double/Triple')">Double/Triple</button>
        </div>
        <div id="items-list"></div>
    </div>

    <div id="admin-tab" class="tab">
        <h3>Admin Panel</h3>
        <textarea id="mass-input" placeholder="user|pass|price" style="height:150px"></textarea>
        <button class="btn" onclick="sendMass()">IMPORT ALL DATA</button>
        <div id="admin-list" style="margin-top:20px"></div>
    </div>
</div>

<div class="navbar">
    <div class="nav-item active-nav" onclick="tab('store-tab')">STORE</div>
    <div id="admin-btn" class="nav-item" style="display:none" onclick="tab('admin-tab')">ADMIN</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const API = "https://laquita-unperturbed-altagracia.ngrok-free.dev";
    let allData = [];

    if(tg.initDataUnsafe.user && tg.initDataUnsafe.user.id == 5939498558) {
        document.getElementById('admin-btn').style.display = 'block';
    }

    function tab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active-nav');
    }

    async function load() {
        const r = await fetch(`${API}/get_all`, {headers:{"ngrok-skip-browser-warning":"true"}});
        const d = await r.json();
        allData = d.items;
        document.getElementById('admin-list').innerHTML = d.items.map(i => `<div class="card"><span>@${i.u}</span></div>`).join('');
    }

    function filter(c) {
        const filtered = allData.filter(i => i.c == c);
        document.getElementById('items-list').innerHTML = filtered.map(i => `<div class="card"><span>@${i.u} - $${i.p}</span></div>`).join('');
    }

    async function sendMass() {
        const val = document.getElementById('mass-input').value;
        if(!val) return;
        await fetch(`${API}/admin/add`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({data:val, user_id:tg.initDataUnsafe.user.id})
        });
        document.getElementById('mass-input').value = '';
        load();
    }

    tg.expand();
    load();
</script>
</body>
</html>
